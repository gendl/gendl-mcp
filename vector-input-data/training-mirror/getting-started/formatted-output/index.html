<!DOCTYPE HTML><html lang="en"><head><title>Formatted output</title><meta charset="UTF-8" /><link rel="icon" type="image/png" href="/gorn.png" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="stylesheet" href="/css/training-style.css" /><script src="/static/3rdpty/x3dom/x3dom.js" id="x3dom_script"></script><script id="svg-panzoom" src="/static/3rdpty/svgpanzoom/svg-pan-zoom.min.js"></script><script>
var gdliid = '/shared';</script><script src="/static/gwl/js/gdlajax1595.js"></script></head><body><div class="container mx-auto"><div class="main-page-item"><div class="mt-1 ml-2 mr-5"><h2>Formatted output</h2><p><a class="text-red-500" href="/getting-started/strings/index.html">&lt;-Previous</a><span class="font-bold"> | </span><a class="text-blue-500" href="/getting-started/index.html">^UP^</a><span class="font-bold"> | </span><a class="text-green-500" href="/getting-started/building-example-2/index.html">Next-&gt;</a></p><div class="main-page-container"><div class="main-page-item"><div class="grid-container-2-650px"><div class="grid-item"><p>When we want more control, flexibility and sophistication with text output we use the <span class="function">format</span> function</p><p>below are some of the most commonly used and useful features of <span class="function">format</span>, but it can sometimes be difficult to understand or read, due to its compactness and its 
non-Lispy syntax. A great resource on the Internet is an article by Peter Seibel, called a few FORMAT recipes
which provides a detailed discussion on the features and uses of <span class="function">format</span> and some very useful examples. See the link in the resources section</p><p><span class="function">Format</span> takes 2 required arguments<ul><li>A <em>destination</em> for its output</li><li>A <em>control string</em> that will generally contain literal text, but will always contain format<em><b>directives</b></em></li></ul>. <span class="function">Format</span> will also generally be provided with extra arguments which are used by the <em><i>directives</i></em> in the control string.</p><h3>Output Destination</h3><p>The <em><b>output destination</b></em> is the first argument to format. There are 4 types of output destination, but we'll discuss just the first 3<ul><li>If the value is <em><span class="general-keyword">T</span></em>, the output destination is the <span class="variable-name">*standard-output*</span> stream</li><li>If the value is <em><span class="value">NIL</span></em>, the output is generated as a string and returned by <span class="function">format</span></li><li>If the destination is a stream, the output will be written to that stream</li></ul></p><h3>Control String</h3><p>The <em>control string</em> may look complex because it is based on characters, not s-expressions,
and is optimised for compactness. In many ways it is another 
mini-programming language within Lisp. As well as containing literal text,
the control string contains format <em><b>directives</b></em>. <ul><li>All <em><b>directives</b></em> start with a tilde (~) character, and end with a single character.
This character can be either upper of lower case</li><li>Some <em><b>directives</b></em> take <em>prefix parameters</em>, between the tilde and the character. If more than one <em>prefix parameter</em> is used they are separated by commas (,). <em>Prefix parameters</em> give additional output control</li><li>Some <em><b>directives</b> use either the colon (:) or at-sign (@) <em><b>modifiers</b></em> which change the behavior of the <em><b>directive</b></em> in small ways</em></li><li>There are also some special <em><b>directives</b></em> which are used in pairs and can be wrapped around other <em><b>directives</b></em>, e.g. to control capitalisation ( <span class="format-directive">~( ~)</span> ), conditional formatting (<span class="format-directive">~[ ~]</span>) or iteration (<span class="format-directive">~{ ~}</span>)</li></ul>This list isn't exhaustive, but contains the most frequently used principles.</p><h3>Basic Formatting</h3><p>The most basic <em><b>directive</b></em> is <span class="format-directive">~a</span>. It consumes one of the <span class="function">format</span> arguments and outputs it in human-readable form. Note that because we are using <span class="value">NIL</span> as the <em><b>output destination</b></em>, <span class="function">format</span> is returning a string as return-value and not outputting anywhere.</p>Another basic <em><b>directive</b></em> is <span class="format-directive">~%</span>, which causes a newline to be emitted. It optionally takes a single <em>prefix parameter</em> that defines how many newlines to be emitted<div class="repl-example"><pre><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(setq text "Hello")</span></p><span class="output">"Hello"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(setq number 123.456)</span></p><span class="output">123.456</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(setq my-list (list 1 2 3))</span></p><span class="output">(1 2 3)</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~a" text)</span></p><span class="output">"Hello"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~a" number)</span></p><span class="output">"123.456"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~a" my-list)</span></p><span class="output">"(1 2 3)"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "Line 1~%Line2")</span></p><span class="output">"Line 1</span><span class="output">Line 2"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "Line 1~%Line2")</span></p><span class="output">"Line 1</span><span class="output"></span><span class="output">Line 2"</span></pre></div><h3>Integer Directives</h3><p>Whist the <em><b>directive</b></em> <span class="format-directive">~a</span> can be used to output numbers, the <em><b>directive</b></em> <span class="format-directive">~d</span> offers more control for outputting integers (d standing for decimal, or base 10). There are 2 <em>modifiers</em>:<ul><li>A colon (<span class="format-directive">:</span>) adds commas separating the number into groups of 3 integers</li><li>An at-sign (<span class="format-directive">@</span>) always prints a sign before the number</li><li>These 2 modifiers may be combined</li></ul>It can also take 2 <em>prefix parameters</em>:<ul><li>The first <em>prefix parameter</em> specifies the minimum width for the output</li><li>The second <em>prefix parameter</em> specifies the padding character. By default this is a space. Padding characters must be quoted are always inserted before the number</li></ul></p><div class="repl-example"><pre><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~d" 1234567)</span></p><span class="output">"1234567"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~:d" 1234567)</span></p><span class="output">"1,234,567"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~@d" 1234567)</span></p><span class="output">"+1234567"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~:@d" 1234567)</span></p><span class="output">"+1,234,567"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~12d" 1234567)</span></p><span class="output">"     1234567"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~12,'0d" 1234567)</span></p><span class="output">"000001234567"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~2,'0d-~2,'0d-~d" 31 7 2022)</span></p><span class="output">"31-07-2022"</span></pre></div><h3>Floating Point Directives</h3><p>The 2 principle <em><b>directives</b></em> handling floating point numbers are <span class="format-directive">~f</span> and <span class="format-directive">~e</span>. The difference is <span class="format-directive">~f</span> is alowed to use scientific notation if the number is large enough or small enough, whilst <span class="format-directive">~e</span> will always emit the number argument in scientific notation. </p><p> There are a number of <em>prefix parameters</em>, but the only one of real significance is the second, which specifies the  number of digits to output after the decimal point. Note that, if this <em>prefix parameter</em> is less than the number of decimal digits in the argument, the argument will be mathematically rounded.</p><p>A third floating point number <em><b>directive</b></em> is <span class="format-directive">~$</span> which is a monetary directive. It is basically equivalent to <span class="format-directive">~f</span> with the second prefix parameter dafaulting to 2</p><div class="repl-example"><pre><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~f" pi)</span></p><span class="output">"3.141592653589793"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~,3f" pi)</span></p><span class="output">3.142</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~e" pi)</span></p><span class="output">"3.141592653589793E+0"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~$" pi)</span></p><span class="output">3.14</span></pre></div><h3>English Language Directives</h3><p>These directives are useful for converting number to english language, outputting plurals and performing case conversions<ul><li><span class="format-directive">~r</span> prints numbers as english words. With the <span class="format-directive">:</span> <em>modifier</em> it prints the number as an ordinal</li><li><span class="format-directive">~p</span> pluralises a word, emitting an <em><span class="general-keyword">s</span></em> character when the argument is anything but 1. It is often used with the <em><span class="format-directive">:</span></em> <em>modifier</em> which makes it reprocess the previous format argument. Using the <em><span class="format-directive">@</span></em> <em>modifier</em> causes a <em><span class="general-keyword">y</span></em> character to be emitted when the format argument is 1, or <em><span class="general-keyword">ies</span></em> to be emitted for other values</li></ul></p><div class="repl-example"><pre><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "computer~p" 1)</span></p><span class="output">"computer"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~r computer~:p" 1)</span></p><span class="output">"one computer"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~r computer~:p" 2)</span></p><span class="output">"two computers"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~r fl~:@p" 1)</span></p><span class="output">"one fly"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~r fl~:@p" 2)</span></p><span class="output">"two flies"</span></pre></div><p>To control case we use the <span class="format-directive">~(</span> directive paired with a <span class="format-directive">~)</span> in conjunction with the 2 <em>modifiers</em> <em><span class="format-directive">:</span></em> and <em><span class="format-directive">@</span></em><ul><li>Without either modifier the output is all lower case</li><li>With the <em><span class="format-directive">@</span></em> <em>modifier</em> the first word is the string between the <span class="format-directive">~(</span> and <span class="format-directive">~)</span> directives is capitalised</li><li>With the <em><span class="format-directive">:</span></em> <em>modifier</em> all words is the string between the <span class="format-directive">~(</span> and <span class="format-directive">~)</span> directives are capitalised</li><li>With both <em>modifiers</em> the output is all upper case</li></ul></p><div class="repl-example"><pre><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(setq txt "sOme RANdom TexT")</span></p><span class="output">"sOme RANdom TexT"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~(~a~)" txt)</span></p><span class="output">"some random text"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~@(~a~)" txt)</span></p><span class="output">"Some random text"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~:(~a~)" txt)</span></p><span class="output">"Some Random Text"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~:@(~a~)" txt)</span></p><span class="output">"SOME RANDOM TEXT"</span></pre></div><h3>Iteration</h3><p>The <span class="format-directive">~{</span> directive paired with<span class="format-directive">~}</span> makes <span class="function">format</span> itterate over the elements of a list. The control string between these 2 <em><b>directives</b></em> will be repeatedly processed as long as there are elements left in the list.</p><p>In many cases we may wish to add some text seperators, for example a comma between the elements in the list, but avoid a final seperator. To do this we use the <span class="format-directive">~^</span> directive before the seperator. By using the <em><span class="format-directive">~@</span></em> modifier, any remaining <span class="function">format</span> arguments are treated as a list</p><div class="repl-example"><pre><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~{~a, ~}" (list 1 2 3))</span></p><span class="output">"1 2 3 "</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~{~a ~}" (list 1 2 3))</span></p><span class="output">"1, 2, 3, "</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~{~a~^,~}" (list 1 2 3))</span></p><span class="output">"1, 2, 3"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~@{~a~^,~}" 1 2 3)</span></p><span class="output">"1, 2, 3"</span></pre></div><h3>Conditionals</h3><p>The <span class="format-directive">~[</span> directive paired with<span class="format-directive">~]</span> provides a simple control construct. Inbetween these directive are a number of clauses seperated by <em><span class="format-directive">~;</span></em> and the argument supplied represents the index number (0 based) of the clasue to be used. If the index number is bigger then the number of clauses nothing is printed, unless the last clause is seperated by <em><span class="format-directive">~:;</span></em> in which case this clause is used as the default if no match is found<p>With the <em><span class="format-directive">~@</span></em> modifier the control string between <span class="format-directive">~[</span> and <span class="format-directive">~]</span> is only emitted if the <span class="function">format</span> argument is non-NIL</p></p><div class="repl-example"><pre><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~[Peter~;Paul~;John~]" 0)</span></p><span class="output">"Peter"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~[Peter~;Paul~;John~]" 4)</span></p><span class="output">""</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~[Peter~;Paul~;;John~]" 4)</span></p><span class="output">"John"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~@[~r cat~:p ~]~@[~r dog~:p~]" nil 2)</span></p><span class="output">"two dogs"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~@[~r cat~:p ~]~@[~r dog~:p~]" 3 nil)</span></p><span class="output">"three cats "</span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format nil "~@[~r cat~:p ~]~@[~r dog~:p~]" 3 1)</span></p><span class="output">"three cats one dog"</span></pre></div></div></div></div><div class="main-page-item"><h2>Resources</h2><table><tr><td><a href="https://gigamonkeys.com/book/a-few-format-recipes.html" target="_new"><img src="/common-images/html-file.png" style="width: 40px; height: auto;" /></a></td><td><a href="https://gigamonkeys.com/book/a-few-format-recipes.html" target="_new">Format Recipes</a></td></tr><tr><td><a href="/t2-resources/format.lisp"><img src="/common-images/lisp-file.png" style="width: 40px; height: auto;" /></a></td><td><a href="/t2-resources/format.lisp">format.lisp</a></td></tr></table></div></div></div></div></div></body></html>