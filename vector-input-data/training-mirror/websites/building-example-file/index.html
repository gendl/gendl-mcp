<!DOCTYPE HTML><html lang="en"><head><title>Wall example - taking inputs from a file</title><meta charset="UTF-8" /><link rel="icon" type="image/png" href="/gorn.png" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="stylesheet" href="/css/training-style.css" /><script src="/static/3rdpty/x3dom/x3dom.js" id="x3dom_script"></script><script id="svg-panzoom" src="/static/3rdpty/svgpanzoom/svg-pan-zoom.min.js"></script><script>
var gdliid = '/shared';</script><script src="/static/gwl/js/gdlajax1595.js"></script></head><body><div class="container mx-auto"><div class="main-page-item"><div class="mt-1 ml-2 mr-5"><h2>Wall example - taking inputs from a file</h2><p><a class="text-red-500" href="/websites/wall-example-form/index.html">&lt;-Previous</a><span class="font-bold"> | </span><a class="text-blue-500" href="/websites/index.html">^UP^</a><span class="font-bold"> | </span><a class="text-green-500" href="/websites/index-page/index.html">Next-&gt;</a></p><div class="main-page-container"><div class="main-page-item"><div class="grid-container-2-650px"><div class="grid-item"></div><p>In the tutorial <a href="/getting-started/index.html">Getting started with GendL</a> we developed an example application to build a model of a building. In that application, all inputs were provided as <span class="keyword">input-slots</span> with default values. We then extended that in the tutorial <a href="/file-io/index.html">Reading from and Writing to Files</a> to take inputs from a file and deliver the output as a file. In this topic, we'll use the building application and extend it to include a web based front end to upload a file via a form.</p><p>The basic design concept is to have a web page as a top level object, which provides a form to upload an input file. The building application based on file inputs will be a child object of the file upload form, and once the file has been uploaded it will be passed to te building application as an inout. An output file will be written and a link to that file displayed on the file upload page</p><p>The first step is to create a file upload form and incorporate the building application as a child object</p><div class="code-example"><pre><span class="code" style="margin-left: 0px;">(in-package :gwl-user)</span><span class="code" style="margin-left: 0px;"></span><span class="code" style="margin-left: 7px;">(define-object building-application-file (base-ajax-sheet)</span><span class="code" style="margin-left: 0px;"></span><span class="code" style="margin-left: 14px;">:computed-slots</span><span class="code" style="margin-left: 14px;">((uploaded-path "" :settable)</span><span class="code" style="margin-left: 21px;">(main-sheet-body (with-cl-who-string ()</span><span class="code" style="margin-left: 105px;">(str (the development-links))</span><span class="code" style="margin-left: 105px;">(when (= (length (the uploaded-path)) 0)</span><span class="code" style="margin-left: 126px;">(htm (with-html-form (:multipart? t :cl-who? t)</span><span class="code" style="margin-left: 196px;">(:table </span><span class="code" style="margin-left: 210px;">(:tr </span><span class="code" style="margin-left: 224px;">(:td</span><span class="code" style="margin-left: 238px;">(:input :type "file" :name :uploaded-path)))</span><span class="code" style="margin-left: 252px;">(:tr (:td (:input :type "submit" :name "upload" :value "Upload")))))))))</span><span class="code" style="margin-left: 0px;">)</span><span class="code" style="margin-left: 0px;"></span><span class="code" style="margin-left: 7px;">:objects</span><span class="code" style="margin-left: 7px;">((building :type 'building</span><span class="code" style="margin-left: 84px;">:input-filename (when (> (length (the uploaded-path)) 1) (the uploaded-path)))</span></pre></div><p>Not that for expediency, the building object has been moved to the gwl-user package for this example</p><p>To generate the output, we need to run the write-bom-file! function in the bulding object, following which we need to publish that file and provide a link to it on the web page. As we will demand the url of the published file, we can use side effecting to run the file generation and publishing, rather than running them as a function. To do this we use a computed-slot output-url and the body form of the let macro to evaulate the file write and publish functions sequentially. We've also defined the output filename, such that it will be in the same directory as the uploaded file, but with a different name</p></div></div></div></div></div></div></body></html>