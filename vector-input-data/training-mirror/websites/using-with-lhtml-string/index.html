<!DOCTYPE HTML><html lang="en"><head><title>Using with-lhtml-string</title><meta charset="UTF-8" /><link rel="icon" type="image/png" href="/gorn.png" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="stylesheet" href="/css/training-style.css" /><script src="/static/3rdpty/x3dom/x3dom.js" id="x3dom_script"></script><script id="svg-panzoom" src="/static/3rdpty/svgpanzoom/svg-pan-zoom.min.js"></script><script>
var gdliid = '/shared';</script><script src="/static/gwl/js/gdlajax1595.js"></script></head><body><div class="container mx-auto"><div class="main-page-item"><div class="mt-1 ml-2 mr-5"><h2>Using with-lhtml-string</h2><p><a class="text-red-500" href="/websites/simple-html-page/index.html">&lt;-Previous</a><span class="font-bold"> | </span><a class="text-blue-500" href="/websites/index.html">^UP^</a><span class="font-bold"> | </span><a class="text-green-500" href="/websites/using-base-html-divs/index.html">Next-&gt;</a></p><div class="grid-container-2-650px"><div class="grid-item"><p><em><b>LHTML</b></em> is a Markup Language included in Gendl (standing for <i>Lisp HTML</i>) which provides a convenient way to generate html using lisp-like expressions. It is intended to be portable and shoud work with all ANSI standard Common Lisp Implementations.</p><p>The main element of <em><b>lhtml</b></em> is the macro <span class="macro">with-lhtml-string</span>, which transforms its body into a html string</p><p>In general, we use <span class="macro">with-lhtml-string</span> when creating html strings for use in GWL web pages</p><p><span class="macro">with-lhtml-string</span> takes an optional input <span class="general-keyword">:indent</span>. By default it is nil which results in html with no unnecessary whitespace to minimise the bandwith being used. But for debugging purposes, the resulting html may be difficult to read. Setting <span class="general-keyword">:indent</span> to t causes line breaks to be inserted and nested tags properly indented<div class="repl-example"><pre><span class="prompt" style="display: inline;">GWL-USER&nbsp;&nbsp;</span><span class="command" style="margin-left: 0px;">(with-lhtml-string ()</span><span class="command-no-prefix" style="margin-left: 84px;">(:table (:tr (:td))))</span><span class="output">"&#60;table>&#60;tr>&#60;td>&#60;/td>&#60;/tr>&#60;/table>"</span><span class="prompt" style="display: inline;">GWL-USER&nbsp;&nbsp;</span><span class="command" style="margin-left: 0px;">(with-lhtml-string (:indent t)</span><span class="command-no-prefix" style="margin-left: 84px;">(:table (:tr (:td))))</span><span class="output">"</span><span class="output">&#60;table></span><span class="output">  &#60;tr></span><span class="output">    &#60;td>&#60;/td></span><span class="output">  &#60;/tr></span><span class="output">&#60;/table>"</span></pre></div></p><h3>Markup</h3><p>To generate html we use a nested list of s-expressions. Each list beginning with a keyword is transformed into a html tag of the same name by the following rules:<ul><li>If the list contains nothing but a <em><b>keyword</b></em> an empty element is written<div class="repl-example"><pre><span class="prompt" style="display: inline;">GWL-USER&nbsp;&nbsp;</span><span class="command" style="margin-left: 0px;">(with-lhtml-string()</span><span class="command-no-prefix" style="margin-left: 77px;">(:br))</span><span class="output">&#60;br /></span></pre></div></li><li>If the <em><b>keyword</b></em> is followed by another <em><b>keyword</b></em>, it's interpreted as an attribute and the next form is the value of that attribute<div class="repl-example"><pre><span class="prompt" style="display: inline;">GWL-USER&nbsp;&nbsp;</span><span class="command" style="margin-left: 0px;">(with-lhtml-string()</span><span class="command-no-prefix" style="margin-left: 77px;">(:span :class "myclass"))</span><span class="output">"&#60;span class="myclass">&#60;/span>"</span></pre></div></li><li>Multiple <em><b>attribute-value pairs</b></em> may be specified<div class="repl-example"><pre><span class="prompt" style="display: inline;">GWL-USER&nbsp;&nbsp;</span><span class="command" style="margin-left: 0px;">(with-lhtml-string()</span><span class="command-no-prefix" style="margin-left: 77px;">(:table :border 1 :cellspacing 3 :cell-padding 5))</span><span class="output">"&#60;table border="1" cellspacing="3" cell-padding="5">&#60;/table>"</span></pre></div></li><li>The first form which isn't a keyword and follows either the tag or an attribute value is interpreted as the <em><b>tag content</b></em><div class="repl-example"><pre><span class="prompt" style="display: inline;">GWL-USER&nbsp;&nbsp;</span><span class="command" style="margin-left: 0px;">(with-lhtml-string()</span><span class="command-no-prefix" style="margin-left: 77px;">(:p "This is content"))</span><span class="output">"&#60;p>This is content&#60;/p>"</span><span class="prompt" style="display: inline;">GWL-USER&nbsp;&nbsp;</span><span class="command" style="margin-left: 0px;">(with-lhtml-string()</span><span class="command-no-prefix" style="margin-left: 77px;">(:span :class "myclass" "This is more content"))</span><span class="output">"&#60;span class="myclass">This is more content&#60;/span>"</span></pre></div></li><li>To make it slightly easier to read, the <em><b>tag and all attribute-value pairs</b></em> may be enclosed in an additional list, but this is purely optional<div class="repl-example"><pre><span class="prompt" style="display: inline;">GWL-USER&nbsp;&nbsp;</span><span class="command" style="margin-left: 0px;">(with-lhtml-string()</span><span class="command-no-prefix" style="margin-left: 77px;">(:span :class "myclass" "This is more content"))</span><span class="output">"&#60;span class="myclass">This is more content&#60;/span>"</span><span class="prompt" style="display: inline;">GWL-USER&nbsp;&nbsp;</span><span class="command" style="margin-left: 0px;">(with-lhtml-string()</span><span class="command-no-prefix" style="margin-left: 77px;">((:span :class "myclass") "This is more content")))</span><span class="output">"&#60;span class="myclass">This is more content&#60;/span>"</span></pre></div></li><li>Tags may be embedded in other tags<div class="repl-example"><pre><span class="prompt" style="display: inline;">GWL-USER&nbsp;&nbsp;</span><span class="command" style="margin-left: 0px;">(with-lhtml-string()</span><span class="command-no-prefix" style="margin-left: 77px;">(:table :border 1</span><span class="command-no-prefix" style="margin-left: 91px;">(:tr</span><span class="command-no-prefix" style="margin-left: 105px;">(:td "Cell 1")</span><span class="command-no-prefix" style="margin-left: 105px;">(:td "Cell 2"))))</span><span class="output">"&#60;table border="1">&#60;tr>&#60;td>Cell 1&#60;/td>&#60;td>Cell 2&#60;/td>&#60;/tr>&#60;/table>"</span></pre></div></li></ul></p><h3>Markup with computed content</h3><p>So far any tag content we have shown is static, so how do we handle computed content? If we just wish to output the value of a slot, we must wrap that slot with the macro <span class="macro">str</span><div class="repl-example"><pre><span class="prompt" style="display: inline;">GWL-USER&nbsp;&nbsp;</span><span class="command" style="margin-left: 0px;">(let ((cell-1 "Cell 1 content")</span><span class="command-no-prefix" style="margin-left: 105px;">(cell-2 "Cell 2 content"))</span><span class="command-no-prefix" style="margin-left: 77px;">(with-lhtml-string ()</span><span class="command-no-prefix" style="margin-left: 98px;">(:table (:tr (:td (str cell-1)) </span><span class="command-no-prefix" style="margin-left: 189px;">(:td (str cell-2))))))</span><span class="output">"&#60;table>&#60;tr>&#60;td>Cell 1 content&#60;/td>&#60;td>Cell 2 content&#60;/td>&#60;/tr>&#60;/table>"</span></pre></div></p><p>If we want to present the value of a slot with some formatting, rather than use the format function to format the value of the slot, we could wrap the value in the macro <span class="macro">fmt</span>, which takes the same directives as the <span class="function">format</span>function<div class="repl-example"><pre><span class="prompt" style="display: inline;">GWL-USER&nbsp;&nbsp;</span><span class="command" style="margin-left: 0px;">(let ((cell-1 1)</span><span class="command-no-prefix" style="margin-left: 105px;">(cell-2 2))</span><span class="command-no-prefix" style="margin-left: 77px;">(with-lhtml--string ()</span><span class="command-no-prefix" style="margin-left: 98px;">(:table (:tr (:td (fmt "Cell ~a content" cell-1)) </span><span class="command-no-prefix" style="margin-left: 189px;">(:td (fmt "Cell ~a content" cell-2))))))</span><span class="output">"&#60;table>&#60;tr>&#60;td>Cell 1 content&#60;/td>&#60;td>Cell 2 content&#60;/td>&#60;/tr>&#60;/table>"</span></pre></div></p><p>It is also possible to embed any type of Lisp processing within the body of <span class="macro">with-lhtml-string</span>, although whenever we break out of the html generation to do some processing, once we restart html generation again we need to wrap the html generation in the <span class="macro">htm</span> macro<div class="repl-example"><pre><span class="prompt" style="display: inline;">GWL-USER&nbsp;&nbsp;</span><span class="command" style="margin-left: 0px;">(with-lhtml-string ()</span><span class="command-no-prefix" style="margin-left: 77px;">(:table (:tr </span><span class="command-no-prefix" style="margin-left: 98px;">(let ((lis (list 1 2)))</span><span class="command-no-prefix" style="margin-left: 119px;">(dolist (a lis)</span><span class="command-no-prefix" style="margin-left: 140px;">(htm (:td (fmt "Cell ~a" a))))))))</span><span class="output">"&#60;table>&#60;tr>&#60;td>Cell 1&#60;/td>&#60;td>Cell 2&#60;/td>&#60;/tr>&#60;/table>"</span></pre></div></p><p>Finally, a word of warning. <em><b> lhtml knows nothing about html, it just processes what it is given according to the rules above</b>. So there is no checking to see if the first keyword is a valid html tag, or if the second keyword is a valid tag attribute. Thats your job!</em></p></div></div></div></div></div></body></html>