<!DOCTYPE HTML><html lang="en"><head><title>Working with Packages</title><meta charset="UTF-8" /><link rel="icon" type="image/png" href="/gorn.png" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="stylesheet" href="/css/training-style.css" /><script src="/static/3rdpty/x3dom/x3dom.js" id="x3dom_script"></script><script id="svg-panzoom" src="/static/3rdpty/svgpanzoom/svg-pan-zoom.min.js"></script><script>
var gdliid = '/shared';</script><script src="/static/gwl/js/gdlajax1595.js"></script></head><body><div class="container mx-auto"><div class="main-page-item"><div class="mt-1 ml-2 mr-5"><h2>Working with Packages</h2><p><span class="font-bold"> | </span><a class="text-blue-500" href="/code-structuring/index.html">^UP^</a><span class="font-bold"> | </span><a class="text-green-500" href="/code-structuring/package-tips/index.html">Next-&gt;</a></p><div class="main-page-container" style="grid-template-columns: 650px auto;"><div class="main-page-item"><p>Packages represent <em>namespaces</em> for Lisp symbols. You can think of them like an "area-code" for symbols.</p><p>In the  tutorial, all of the example code that was provided started with the <em><b>(in-package :gdl-user)</b></em> statement. All of the symbols created when objects were defined, belonged to the <span class="package-name">:gdl-user</span> package. Because all source code files stared with the <em><b>(in-package :gdl-user)</b></em> statement we don't need to qualify any of the symbols, we just use their name. But if we wanted to use a symbol from another package that wasn't used by <span class="package-name">:gdl-user</span> we would need to qualify that symbol with a package name. </p><p>To create a package, we<ul><li>Call the Gendl macro <span class="macro">define-package</span></li><li>Define the <em><b>name</b></em> of the new package</li><li>Optionally provide a list of packages it will <span class="object-keyword">:use</span>. Note that <span class="macro">define-package</span> automatically includes the following packages: <ul><li><span class="package-name">:common-lisp</span></li><li><span class="package-name">:gdl</span></li><li><span class="package-name">:geom-base</span></li><li><span class="package-name">:surf</span></li></ul></li><li>Optionally define a list of symbols that the package will <span class="object-keyword">:export</span></li></ul>In most cases we create a lisp file, normally called package.lisp <em>(this is just a convention, not a requirement)</em> to do this. We need to set a working pakage and for this the <span class="package-name">:gdl-user</span> package is suitable. The we call the GendL <span class="macro">define-package</span> macro. So if we define some package code like this</p><div class="code-example"><pre><span class="code" style="margin-left: 0px;">(in-package :gdl-user)</span><span class="code" style="margin-left: 0px;"></span><span class="code" style="margin-left: 0px;">(define-package :my-app)</span></pre></div><p>Then in the REPL we can use the <span class="function">in-package</span> function to switch to out new package</p><div class="repl-example"><pre><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(in-package :my-app)</span></p><span class="output">#&#60;Package "MY-APP"></span></pre></div><h3>The :export option</h3><p>When we define a new package we can <span class="object-keyword">:export</span> symbols from that package for external use. Whilst symbols from that package can still be accessed even if the aren't <span class="object-keyword">exported</span>, it isn't considered to be good practice to do this, it's up to the package owner to choose to <span class="object-keyword">export</span> or <em>expose</em> which symbols are for external use. A good watchword is <ul><li><em><b>"Not Exported = Unsupported"</b></em></li></ul></p><p>Extending our <span class="macro">define-package</span> example to <span class="object-keyword">:export</span> a symbol <span class="slot">my-slot</span> from our package would look like this</p><div class="code-example"><pre><span class="code" style="margin-left: 0px;">(in-package :gdl-user)</span><span class="code" style="margin-left: 0px;"></span><span class="code" style="margin-left: 0px;">(define-package :my-app</span><span class="code" style="margin-left: 28px;">(:export #:my-slot))</span></pre></div><p>In some cases it is convenient to <span class="object-keyword">:export</span> a symbol after <span class="macro">define-package</span> has been evaluated. This may be the case, for example, where we have a number of functions to be <span class="object-keyword">:exported</span> and it is easier to manage the <span class="object-keyword">:export</span> from within the functions source code file. To do this we can use the Common Lisp Special Operator <span class="special-operator">eval-when</span> as shown in the example below</p><div class="code-example"><pre><span class="code" style="margin-left: 0px;">(in-package :functions)</span><span class="code" style="margin-left: 0px;">(eval-when (load eval) (export 'average))</span><span class="code" style="margin-left: 0px;">(defun average (lis)</span><span class="code" style="margin-left: 14px;">(/ (apply '+ lis) (length lis)))</span></pre></div><p>In this example the function <span class="function">average</span> is exported from the <span class="object-keyword">:functions</span> package when either a top-level form in a compiled file is being loaded (<em><b>load</b></em>) or when the expression would be evaluated anyway (<em><b>eval</b></em>)</p><h3>The :use option</h3><p>To access a symbol which has been <span class="object-keyword">exported</span> from a package we need to use the fully qualified name for that symbol - in other words its package and symbol seperated by a colon. However, if we <span class="object-keyword">:use</span> a package when we create a new package, we can access <span class="object-keyword">exported</span> symbols using their symbol only. Creating a new package which  <span class="object-keyword">uses</span> the package created earlier would look like this</p><div class="code-example"><pre><span class="code" style="margin-left: 0px;">(in-package :gdl-user)</span><span class="code" style="margin-left: 0px;"></span><span class="code" style="margin-left: 0px;">(define-package :my-other-app</span><span class="code" style="margin-left: 28px;">(:use :my-app))</span></pre></div><h3>Bringing it all together</h3><p>Let's consider 3 packages, <span class="package-name">package-a</span>, <span class="package-name">package-b</span> and <span class="package-name">package-c</span>. Package <span class="package-name">package-a</span> <span class="object-keyword">exports</span> a symbol <span class="slot">x</span> and also defines another symbol <span class="slot">y</span>. Package <span class="package-name">package-b</span> doesn't <span class="object-keyword">:export</span> any symbols and doesn't <span class="object-keyword">:use</span> any other packages. Package <span class="package-name">package-c</span> <span class="object-keyword">:uses</span> package <span class="package-name">package-a</span></p><div class="repl-example"><pre><span class="prompt" style="display: inline;">GDL-USER>&nbsp;&nbsp;</span><span class="command" style="margin-left: 0px;">(define-package package-a</span><span class="command-no-prefix" style="margin-left: 84px;">(:export x))</span><span class="output">#&#60;Package "PACKAGE-A"></span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(define-package package-b)</span></p><span class="output">#&#60;Package "PACKAGE-B"></span><span class="prompt" style="display: inline;">GDL-USER>&nbsp;&nbsp;</span><span class="command" style="margin-left: 0px;">(define-package package-c</span><span class="command-no-prefix" style="margin-left: 84px;">(:use a))</span><span class="output">#&#60;Package "PACKAGE-C"></span><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(in-package package-a)</span></p><span class="output">#&#60;Package "PACKAGE-A"></span><p style="display: inline;"><span class="prompt" style="display: inline;">PACKAGE-A>&nbsp;</span><span class="command" style="display: inline;">(setq x 1)</span></p><span class="output">1</span><p style="display: inline;"><span class="prompt" style="display: inline;">PACKAGE-A>&nbsp;</span><span class="command" style="display: inline;">(setq y 2)</span></p><span class="output">1</span><p style="display: inline;"><span class="prompt" style="display: inline;">PACKAGE-A>&nbsp;</span><span class="command" style="display: inline;">(in-package package-b)</span></p><span class="output">#&#60;Package "B"></span><p style="display: inline;"><span class="prompt" style="display: inline;">PACKAGE-B>&nbsp;</span><span class="command" style="display: inline;">x</span></p><span class="error">; Evaluation aborted on #&#60;UNBOUND-VARIABLE #x2103CD8FCD>.</span><p style="display: inline;"><span class="prompt" style="display: inline;">PACKAGE-B>&nbsp;</span><span class="command" style="display: inline;">y</span></p><span class="error">; Evaluation aborted on #&#60;UNBOUND-VARIABLE #x2103CD8FCD>.</span><p style="display: inline;"><span class="prompt" style="display: inline;">PACKAGE-B>&nbsp;</span><span class="command" style="display: inline;">package-a:x</span></p><span class="output">1</span><p style="display: inline;"><span class="prompt" style="display: inline;">PACKAGE-B>&nbsp;</span><span class="command" style="display: inline;">package-a:y</span></p><span class="error">; Evaluation aborted on #&#60;SIMPLE-ERROR #x2103CA28BD>.</span><p style="display: inline;"><span class="prompt" style="display: inline;">PACKAGE-B>&nbsp;</span><span class="command" style="display: inline;">package-a::y</span></p><span class="output">2</span><p style="display: inline;"><span class="prompt" style="display: inline;">PACKAGE-B>&nbsp;</span><span class="command" style="display: inline;">(in-package c)</span></p><span class="output">#&#60;Package "C"></span><p style="display: inline;"><span class="prompt" style="display: inline;">PACKAGE-C>&nbsp;</span><span class="command" style="display: inline;">x</span></p><span class="output">1</span><p style="display: inline;"><span class="prompt" style="display: inline;">PACKAGE-C>&nbsp;</span><span class="command" style="display: inline;">y</span></p><span class="output">; Evaluation aborted on #&#60;UNBOUND-VARIABLE #x2103CD8FCD>.</span><p style="display: inline;"><span class="prompt" style="display: inline;">PACKAGE-C>&nbsp;</span><span class="command" style="display: inline;">package-a:y</span></p><span class="output">; Evaluation aborted on #&#60;SIMPLE-ERROR #x2103CA28BD>.</span><p style="display: inline;"><span class="prompt" style="display: inline;">PACKAGE-C>&nbsp;</span><span class="command" style="display: inline;">package-a::y</span></p><span class="output">2</span></pre></div><p>When we are in package <span class="package-name">package-b</span>, which does not <span class="object-keyword">:use</span> package <span class="package-name">package-a</span><ul><li>we can access exported symbols from package <span class="package-name">package-a</span> but need to qualify the symbol with the <em><b>package name and a single colon</b></em></li><li>we can access unexported symbols from package <span class="package-name">package-a</span> but need to qualify the symbol with the <em><b>package name and double colon</b></em></li></ul><p>When we are in package <span class="package-name">package-c</span>, which does <span class="object-keyword">:use</span> package <span class="package-name">package-a</span><ul><li>we can access exported symbols from package <span class="package-name">package-a</span> just by their name</li><li>we can access unexported symbols from package <span class="package-name">package-a</span> but need to qualify the symbol with the <em><b>package name and a double colon</b></em></li></ul></p></p></div><div class="main-page-item"><h2>Resources</h2><table><tr><td><a href="/t3-resources/packages.lisp"><img src="/common-images/lisp-file.png" style="width: 40px; height: auto;" /></a></td><td><a href="/t3-resources/packages.lisp">packages.lisp</a></td></tr></table></div></div></div></div></div></body></html>