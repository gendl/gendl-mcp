<!DOCTYPE HTML><html lang="en"><head><title>Package Tips</title><meta charset="UTF-8" /><link rel="icon" type="image/png" href="/gorn.png" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="stylesheet" href="/css/training-style.css" /><script src="/static/3rdpty/x3dom/x3dom.js" id="x3dom_script"></script><script id="svg-panzoom" src="/static/3rdpty/svgpanzoom/svg-pan-zoom.min.js"></script><script>
var gdliid = '/shared';</script><script src="/static/gwl/js/gdlajax1595.js"></script></head><body><div class="container mx-auto"><div class="main-page-item"><div class="mt-1 ml-2 mr-5"><h2>Package Tips</h2><p><a class="text-red-500" href="/code-structuring/working-with-packages/index.html">&lt;-Previous</a><span class="font-bold"> | </span><a class="text-blue-500" href="/code-structuring/index.html">^UP^</a><span class="font-bold"> | </span><a class="text-green-500" href="/code-structuring/code-structuring/index.html">Next-&gt;</a></p><div class="main-page-container" style="grid-template-columns: 600px auto;"><div class="main-page-item"><h3>When to use packages</h3><ul><li>If you are starting a new application or project</li><li>If you find yourself copying and pasting from another project/application (create a new package that would be shared between the 2 projects/applications, put the code in that new package and export the symbol</li><li>If you are writing some general purpose functions which you intend to share</li></ul><h3>Some package guidelines</h3><p>When working with packages theres a few things you need to know to make it all work smoothly</p><ol><li><em><b>Packages must be defined before you can Load or Compile a file containing an in-package statement refering to that package</b></em><p>This means there is an order in which files must be loaded, in turn implying that the code defining a package should be in a separate file to code that uses those packages. We'll get onto both of these topics later</p></li><li><em><b>Packages must be defined before other packages can refer to them</b></em><p>Practically this means avoiding circularities in the <span class="object-keyword">:use</span> statement, but again implies form form of load order which again means keeping code defining packages in separate files</p></li><li><em><b>Code files should contain one, <em>and only one</em>, <span class="function">in-package</span> statement and this should be the first line of code in that file</b></em><p>As far as Common Lisp is concerned you can put multiple in-package statements in a file. There are however 2 reasons why this approach would be considered good practice<ul><li>It avoids confusing humand who might not notice a second or third in-package statement</li><li>The emacs/SLIME development environment look for the in-package statement to determine the package to be used when communicationg with Common Lisp and multiple in-package statement may confuse these tools</li></ul></p></li><li><em><b>A final consideration is naming of Packages and particularly avoiding package name clashes.</b></em><p>This isn't generally a problem when you are only using packages that you have developed, but if you are sharing them with other programmers, or using third party packages this needs to be considered, with some kind of naming convention. As a package name is just a text string you can adopt any convention you choose. A trend seems to be a reverse internet domain name followed by a description, for example com.genworks.my-app</p></li></ol><h3>Some package gotcha's</h3><p>Generally once you've got working with packages you won't need to think about them that much, they just do what they're supposed to do. But occasionally, and mainly when setting up new packages, there can be a few 'odd' errors. Perhaps the most common is symbol conflicts. Consider the following case<ul><li>You create a package, say <span class="package-name">my-package</span>, which you expect to use a function, say <span class="function">test-function</span>, which is <span class="object-keyword">:exported</span> from another package <span class="package-name">my-functions</span></li><li>In the source code for the app using <span class="package-name">my-package</span>, you refer to <span class="function">test-function</span> by its symbol only - which is fine because its <span class="object-keyword">exported</span></li><li>But you've forgotten to <span class="object-keyword">:use</span> <span class="package-name">my-functions</span> when defining the package <span class="package-name">my-package</span></li>So when you try to run the compiled code, you'll get an <em><b>'undefined function'</b></em> error. No problem, you return to the <span class="macro">define-package</span> statement for <span class="package-name">my-package</span>, add <em><b>(:use my-functions)</b></em> and then try to run again. This time you get a <em><b>conflicting symbols</b></em> error! Whats happened here is that the first time you run the code the the symbol <span class="function">test-function</span> is interned in <span class="package-name">my-package</span>. Then you <span class="object-keyword">:use</span> <span class="package-name">my-functions</span> from which <span class="function">test-function</span> is exported so you've got a <em><b>conflicting symbol</b></em> clash! The solution is to accept the restart to unintern <span class="function">test-function</span> from <span class="package-name">my-package</span> and then recompile the <span class="package-name">my-package</span> package</ul></p><p>Another issue potential issue is<ul><li>You create a package, say <span class="package-name">my-package</span>, which <span class="object-keyword">:uses</span> <span class="package-name">my-functions</span></li><li><span class="package-name">my-functions</span> <span class="object-keyword">:exports</span> a number of functions</li><li>You then define a function in <span class="package-name">my-package</span> which has the same symbol as a function <span class="object-keyword">:exported</span> from <span class="package">my-functions</span></li></ul>What will happen here is that your function in <span class="package-name">my-package</span> will effectively overwrite the function of the same name in <span class="package-name">my-functions</span>. In most Lisps you'll get a warning that a symbol is being redefined, but its not classed as an error</p><p>A final package-related issue is to do with dropping out of Geysr into the REPL to do some debugging. If the debugging is referring to slots defined in a package other than the REPL's current package, when you try to evaluate the slot you'll get an 'undefined function' error. The simple solution to this is to change the REPL's package, using the in-package function, to the package of the code that you're working with and evaluate the expression again</p></div></div></div></div></div></body></html>