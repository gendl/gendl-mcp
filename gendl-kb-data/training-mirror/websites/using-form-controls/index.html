<!DOCTYPE HTML><html lang="en"><head><title>Gathering inputs using form-controls</title><meta charset="UTF-8" /><link rel="icon" type="image/png" href="/gorn.png" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="stylesheet" href="/css/training-style.css" /><script src="/static/3rdpty/x3dom/x3dom.js" id="x3dom_script"></script><script id="svg-panzoom" src="/static/3rdpty/svgpanzoom/svg-pan-zoom.min.js"></script><script>
var gdliid = '/shared';</script><script src="/static/gwl/js/gdlajax1595.js"></script></head><body><div class="container mx-auto"><div class="main-page-item"><div class="mt-1 ml-2 mr-5"><h2>Gathering inputs using form-controls</h2><p><a class="text-red-500" href="/websites/using-base-html-divs/index.html">&lt;-Previous</a><span class="font-bold"> | </span><a class="text-blue-500" href="/websites/index.html">^UP^</a><span class="font-bold"> | </span><a class="text-green-500" href="/websites/using-ajax/index.html">Next-&gt;</a></p><div class="main-page-container"><div class="main-page-item"><div class="grid-container-2-650px"><div class="grid-item"><p>html defines a number of input types which are used to gather inputs from users. In GendL, each input type is called a form control. Form Controls are implemented as objects. The following table shows the most commonly used html form types and the associated gendL object</p><table border="1" border-style="solid"><tr><th>html type</th><th>GendL object</th></tr><tr><td>&lt;input type=&quot;text&quot;&gt;</td><td>text-form-control</td></tr><tr><td>&lt;input type=&quot;number&quot;&gt;</td><td>number-form-control</td></tr><tr><td>&lt;input type=&quot;password&quot;&gt;</td><td>password-form-control</td></tr><tr><td>&lt;input type=&quot;checkbox&quot;&gt;</td><td>checkbox-form-control</td></tr><tr><td>&lt;input type=&quot;radio&quot;&gt;</td><td>radio-form-control</td></tr><tr><td>&lt;select&gt;</td><td>menu-form-control</td></tr></table><h3>Displaying a form control</h3><p>Once a form control object has been created, there are a number of ways to display it in a web form<ul><li>Use the form control objects <span class="general-keyword">:form-control</span> message. This evaluates to the basic html string required for the form control</li><li>Define a <span class="object-keyword">:prompt</span> input for the form control object and use the form control objects <span class="general-keyword">:prompt</span> and <span class="general-keyword">:form-control</span> messages and do your own custom layout</li><li>Define a <span class="object-keyword">:prompt</span> input for the form control object and use the form control objects <span class="general-keyword">:html-string</span> message to display a label and the form control html</li><li>Define a <span class="object-keyword">:layout-position</span> input for the form control object to give more control over where the label is positioned in the html-string </li></ul></p></div><div class="grid-item"></div><div class="grid-item"><div class="code-example"><pre><span class="code" style="margin-left: 0px;">(define-object form-control-layout (base-html-page)</span><span class="code" style="margin-left: 0px;"></span><span class="code" style="margin-left: 7px;">:computed-slots</span><span class="code" style="margin-left: 7px;">((additional-header-content (with-lhtml-string()</span><span class="code" style="margin-left: 224px;">((:link :rel "stylesheet" :href "/style.css"))))</span><span class="code" style="margin-left: 0px;"></span><span class="code" style="margin-left: 14px;">(body (with-lhtml-string ()</span><span class="code" style="margin-left: 154px;">(when gwl:*developing?* (str (the development-links)))</span><span class="code" style="margin-left: 154px;">(:h3 "Just using the form-control message")</span><span class="code" style="margin-left: 154px;">(str (the fc-1 form-control))</span><span class="code" style="margin-left: 154px;">(:h3 "Using :prompt and form-control in my own table layout")</span><span class="code" style="margin-left: 154px;">(:table (:tr (:td (str (the fc-2 prompt)))</span><span class="code" style="margin-left: 245px;">(:td (str (the fc-2 form-control)))))</span><span class="code" style="margin-left: 154px;">(:h3 "Using html-string (defaulting to :layout-position :as-div)")</span><span class="code" style="margin-left: 154px;">(str (the fc-3 html-string))</span><span class="code" style="margin-left: 154px;">(:h3 "Using other :layout-position")</span><span class="code" style="margin-left: 154px;">(str (the fc-4 html-string))</span><span class="code" style="margin-left: 154px;">(:br)</span><span class="code" style="margin-left: 154px;">(str (the fc-5 html-string)))))</span><span class="code" style="margin-left: 7px;">:objects</span><span class="code" style="margin-left: 7px;">((fc-1 :type 'text-form-control</span><span class="code" style="margin-left: 56px;">:size 12</span><span class="code" style="margin-left: 56px;">:default nil)</span><span class="code" style="margin-left: 14px;">(fc-2 :type 'text-form-control</span><span class="code" style="margin-left: 56px;">:size 12</span><span class="code" style="margin-left: 56px;">:prompt "My form control"</span><span class="code" style="margin-left: 56px;">:default nil)</span><span class="code" style="margin-left: 14px;">(fc-3 :type 'text-form-control</span><span class="code" style="margin-left: 56px;">:size 12</span><span class="code" style="margin-left: 56px;">:prompt "My form control with html-string"</span><span class="code" style="margin-left: 56px;">:default nil)</span><span class="code" style="margin-left: 14px;">(fc-4 :type 'text-form-control</span><span class="code" style="margin-left: 56px;">:size 12</span><span class="code" style="margin-left: 56px;">:prompt "Label display #1 - prepended label"</span><span class="code" style="margin-left: 56px;">:default nil</span><span class="code" style="margin-left: 56px;">:label-position :prepend)</span><span class="code" style="margin-left: 14px;">(fc-5 :type 'text-form-control</span><span class="code" style="margin-left: 56px;">:size 12</span><span class="code" style="margin-left: 56px;">:prompt "Label display #2 - appended label"</span><span class="code" style="margin-left: 56px;">:default nil</span><span class="code" style="margin-left: 56px;">:label-position :append)))</span></pre></div></div><div class="grid-item"><image src="/t6-images/fc-display.png" style="border: 2px solid; margin: 5px 0 0 3% ;width: auto; height: 300px;"></image></div><div class="grid-item"><h3>Form control inputs</h3><p>Form controls can take a large number of inputs to provide the desired control. YADD provides a comprehensive guide to these inputs (GWL..base-form-control). We won't cover them all here, but the most common are</p><p><ul><li><span class="object-keyword">:default</span> (required) - the default value for the form control</li><li><span class="object-keyword">:prompt</span> (optional) - the label associated with the form control</li><li><span class="object-keyword">:layout-position</span> (optional) - control over where the label is presented in the html-string message</li><li><span class="object-keyword">:size</span> (optional) - for text, number and password form controls it defines the length of the input box. For menu form controls it defines the number of options displayed</li><li><span class="object-keyword">:choice-list</span> (optional) - for menu and radio form controls, defines the options to be displayed. When selected the displayed value is the value returned by the form control</li><li><span class="object-keyword">:choice-plist</span> (optional) - for menu and radio form controls, defines the options to be displayed (value element of the plist). In contrast to choice-list, when an option is selected the form controls returns the plist keyword associated with the selected value</li></ul></p></div><div class="grid-item"></div><div class="grid-item"><div class="repl-example"><pre><span class="prompt" style="display: inline;">GWL-USER&nbsp;&nbsp;</span><span class="command" style="margin-left: 0px;">(make-self 'menu-form-control</span><span class="command-no-prefix" style="margin-left: 63px;">:size 1</span><span class="command-no-prefix" style="margin-left: 63px;">:choice-list (list "Peter" "Paul" "John")</span><span class="command-no-prefix" style="margin-left: 63px;">:default "Peter")</span><span class="output">#&#60;MENU-FORM-CONTROL #x2104C2296D></span><p style="display: inline;"><span class="prompt" style="display: inline;">GWL-USER&nbsp;</span><span class="command" style="display: inline;">(the form-control)</span></p><span class="output">"</span><span class="output">&#60;select name="TklM" id="TklM" size="1"></span><span class="output">   &#60;option value="Peter" selected="selected">Peter&#60;/option></span><span class="output">   &#60;option value="Paul">Paul&#60;/option></span><span class="output">   &#60;option value="John">John&#60;/option></span><span class="output">&#60;/select>"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GWL-USER&nbsp;</span><span class="command" style="display: inline;">(the value)</span></p><span class="output">"Peter"</span></pre></div></div><div class="grid-item"><div class="repl-example"><pre><span class="prompt" style="display: inline;">GWL-USER&nbsp;&nbsp;</span><span class="command" style="margin-left: 0px;">(make-self 'menu-form-control</span><span class="command-no-prefix" style="margin-left: 63px;">:size 1</span><span class="command-no-prefix" style="margin-left: 63px;">:choice-plist (list :name-1 "Peter" </span><span class="command-no-prefix" style="margin-left: 203px;">:name-2 "Paul" </span><span class="command-no-prefix" style="margin-left: 203px;">:name-3 "John")</span><span class="command-no-prefix" style="margin-left: 63px;">:default "Peter")</span><span class="output">#&#60;MENU-FORM-CONTROL #x2104C2296D></span><p style="display: inline;"><span class="prompt" style="display: inline;">GWL-USER&nbsp;</span><span class="command" style="display: inline;">(the form-control)</span></p><span class="output">"</span><span class="output">&#60;select name="TklM" id="TklM" size="1"></span><span class="output">   &#60;option value=":NAME-1" selected="selected">Peter&#60;/option></span><span class="output">   &#60;option value=":NAME-2">Paul&#60;/option></span><span class="output">   &#60;option value=":NAME-3">John&#60;/option></span><span class="output">&#60;/select>"</span><p style="display: inline;"><span class="prompt" style="display: inline;">GWL-USER&nbsp;</span><span class="command" style="display: inline;">(the value)</span></p><span class="output">:NAME-1</span></pre></div></div><div class="grid-item"><h3>Returning values from Form Controls</h3><p>Every form control support the <span class="general-keyword">:value</span> message, which is the selected or entered value for the form control following form submission</p><p>Note that for text form controls, if the form control is empty on submission then NIL will be returned if the <span class="object-keyword">:nullify-empty-string?</span> input to the form control is T, otherwise an empty string will be returned</p><h3>Capturing a form control value</h3><p>Any form containing form controls needs to be submitted in order for the form control entered value to be captured. The simplest, and reccomended, way to do this, is to use the <span class="object-keyword">:ajax-submit-on-change?</span> input to the form control. With this set to T whenever the form control value is changed an AJAX update will be performed to submit the form and capture the value. We'll cover using AJAX in the next topic.</p><h3>Resetting a form control</h3><p>Every form constrol support a function <span class="function">restore-defaults!</span> which sets <span class="object-keyword">:value</span>, <span class="object-keyword">:failed-value</span> and <span class="object-keyword">:error</span> back to default values</p><h3>Validating inputs</h3><p>All form controls have a <span class="object-keyword">:validation-function</span> input. This function defines the rule(s) against which the provided input is tested to determine if it is valid. Any function may be used, but quite often a lambda function is a good solution as the validation is generally specific to the form control and its applcation. The function return values are used to determine what happens with the input<ul><li>If it returns nil, the input is considered invalid and the <span class="slot">error</span> slot is set to <span class="general-keyword">:unspecified-validation-fail</span></li><li>It may return a plist with keys <span class="general-keyword">:validated-value</span> and <span class="general-keyword">:error</span>. If <span class="general-keyword">:error</span> is non-nil this signifies validation has failed and the error value will be appended to <span class="slot">html-string</span></li><li>If any other value is returned, the input is considered valid</li></ul></p></div><div class="grid-item"></div><div class="grid-item"><div class="code-example"><pre><span class="code" style="margin-left: 0px;">(define-object form-control-validation (base-html-page)</span><span class="code" style="margin-left: 7px;">:computed-slots</span><span class="code" style="margin-left: 7px;">((main-sheet-body (with-lhtml-string ()</span><span class="code" style="margin-left: 161px;">(when gwl:*developing?* (str (the development-links)))</span><span class="code" style="margin-left: 161px;">(:h3 "Form control validation")</span><span class="code" style="margin-left: 161px;">(str (the fc-section main-div)))))</span><span class="code" style="margin-left: 7px;">:objects</span><span class="code" style="margin-left: 7px;">((fc-section :type 'sheet-section</span><span class="code" style="margin-left: 98px;">:inner-html (with-lhtml-string ()</span><span class="code" style="margin-left: 217px;">(:p (str (the number-fc html-string)))</span><span class="code" style="margin-left: 217px;">(when (the number-fc value)</span><span class="code" style="margin-left: 245px;">(htm (:p (fmt "the number value is ~a"</span><span class="code" style="margin-left: 336px;">(the number-fc value)))))</span><span class="code" style="margin-left: 217px;">(when (the number-fc error)</span><span class="code" style="margin-left: 245px;">(html (:p (fmt "error is ~a, failed value is ~a"</span><span class="code" style="margin-left: 336px;">(the number-fc error)</span><span class="code" style="margin-left: 336px;">(the number-fc failed-value)))))))</span><span class="code" style="margin-left: 0px;"></span><span class="code" style="margin-left: 7px;">(number-fc :type 'number-form-control</span><span class="code" style="margin-left: 84px;">:default nil</span><span class="code" style="margin-left: 84px;">:size 12</span><span class="code" style="margin-left: 84px;">:ajax-submit-on-change? t</span><span class="code" style="margin-left: 84px;">:validation-function #'(lambda(input)</span><span class="code" style="margin-left: 273px;">(cond ((or (<= input 50) (>= input 60))</span><span class="code" style="margin-left: 322px;">(list :validated-value input</span><span class="code" style="margin-left: 364px;">:error :value-out-of-range))</span><span class="code" style="margin-left: 315px;">(T T))))))</span></pre></div></div><div class="grid-item"><image src="/t6-images/valid-fc.png" style="border: 2px solid; margin: 5px 0 0 3% ;width: auto; height: 200px;"></image><br /><image src="/t6-images/invalid-fc.png" style="border: 2px solid; margin: 5px 0 0 3% ;width: auto; height: 200px;"></image></div><div class="grid-item"><p>Note that in the invalid entry, the text formatted red is output (and styled) as part of <span class="slot">html-string</span>, whilst the strings below it directly access the <span class="slot">value</span>, <span class="slot">error</span> and <span class="slot">failed-value</span> slots</p></div></div></div><div class="main-page-item"><h2>Resources</h2><table><tr><td><a href="/t6-resources/gwl-patches.lisp"><img src="/common-images/lisp-file.png" style="width: 40px; height: auto;" /></a></td><td><a href="/t6-resources/gwl-patches.lisp">gwl-patches.lisp</a></td></tr><tr><td><a href="/t6-resources/basic-form-controls.lisp"><img src="/common-images/lisp-file.png" style="width: 40px; height: auto;" /></a></td><td><a href="/t6-resources/basic-form-controls.lisp">basic-form-controls.lisp</a></td></tr><tr><td><a href="/t6-resources/using-form-controls.lisp"><img src="/common-images/lisp-file.png" style="width: 40px; height: auto;" /></a></td><td><a href="/t6-resources/using-form-controls.lisp">using-form-controls.lisp</a></td></tr></table></div></div></div></div></div></body></html>