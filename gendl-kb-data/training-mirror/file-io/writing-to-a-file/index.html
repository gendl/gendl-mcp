<!DOCTYPE HTML><html lang="en"><head><title>Writing to a file</title><meta charset="UTF-8" /><link rel="icon" type="image/png" href="/gorn.png" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="stylesheet" href="/css/training-style.css" /><script src="/static/3rdpty/x3dom/x3dom.js" id="x3dom_script"></script><script id="svg-panzoom" src="/static/3rdpty/svgpanzoom/svg-pan-zoom.min.js"></script><script>
var gdliid = '/shared';</script><script src="/static/gwl/js/gdlajax1595.js"></script></head><body><div class="container mx-auto"><div class="main-page-item"><div class="mt-1 ml-2 mr-5"><h2>Writing to a file</h2><p><a class="text-red-500" href="/file-io/file-io-basics/index.html">&lt;-Previous</a><span class="font-bold"> | </span><a class="text-blue-500" href="/file-io/index.html">^UP^</a><span class="font-bold"> | </span><a class="text-green-500" href="/file-io/reading-from-a-file/index.html">Next-&gt;</a></p><div class="main-page-container" style="grid-template-columns: 700px auto;"><div class="main-page-item"><p>In the previous topic, we concluded by recomending that the CL macro <span class="macro">with-open-file</span> was used for any file input or output. So lets have a look at using this macro to write to a file</p><p>To write output to a file C:/temp/my-file.txt using <span class="macro">with-open-file</span> woud look like the following</p><div class="repl-example"><pre><span class="prompt" style="display: inline;">GDL-USER>&nbsp;&nbsp;</span><span class="command" style="margin-left: 0px;">(with-open-file (s "c:/temp/my-file.txt"</span><span class="command-no-prefix" style="margin-left: 196px;">:direction :output</span><span class="command-no-prefix" style="margin-left: 196px;">:if-exists :supersede</span><span class="command-no-prefix" style="margin-left: 196px;">:if-does-not-exist :create)</span><span class="command-no-prefix" style="margin-left: 105px;">(format s "Line 1 of text~%")</span><span class="command-no-prefix" style="margin-left: 105px;">(format s "Line 1 of text~%")</span><span class="output">NIL</span></pre></div><p>which will produce the following content in the file c:/temp/my-file.txt</p><div class="code-example"><pre><span class="code" style="margin-left: 0px;">Line 1 of text</span><span class="code" style="margin-left: 0px;">Line 1 of text</span></pre></div><p>note that the stream <b>s</b> only exists within the context of the <span class="macro">with-open-file</span> body of expressions</p><p>In many cases, file output is implemented as a :function in a GendL object, although it is perfectly feasible to implement it as a side effect of a :computed-slot. Consider the following simple example</p><div class="code-example"><pre><span class="code" style="margin-left: 0px;">(define-object my-box (box)</span><span class="code" style="margin-left: 7px;">:input-slots</span><span class="code" style="margin-left: 7px;">((output-filename "c:/temp/my-box-report"))</span><span class="code" style="margin-left: 0px;"></span><span class="code" style="margin-left: 7px;">:computed-slots</span><span class="code" style="margin-left: 7px;">((width 3)</span><span class="code" style="margin-left: 14px;">(height 4)</span><span class="code" style="margin-left: 14px;">(length 6))</span><span class="code" style="margin-left: 0px;"></span><span class="code" style="margin-left: 7px;">:functions</span><span class="code" style="margin-left: 7px;">((write-report!()</span><span class="code" style="margin-left: 7px;">(with-open-file (s (the output-filename)</span><span class="code" style="margin-left: 21px;">:direction :output</span><span class="code" style="margin-left: 21px;">:if-exists :supersede</span><span class="code" style="margin-left: 21px;">:if-does-not-exist :create)</span><span class="code" style="margin-left: 7px;">(let ((i 0))</span><span class="code" style="margin-left: 21px;">(format t "Begining output to ~a~%" (the output-filename))</span><span class="code" style="margin-left: 21px;">(format s "Box Width ~a~%" (the width))</span><span class="code" style="margin-left: 21px;">(incf i)</span><span class="code" style="margin-left: 21px;">(format s "Box Length ~a~%" (the length))</span><span class="code" style="margin-left: 21px;">(incf i)</span><span class="code" style="margin-left: 21px;">(format s "Box Height ~a~%" (the height))</span><span class="code" style="margin-left: 21px;">(incf i)</span><span class="code" style="margin-left: 21px;">(format s "Box Center ~@{~,1f~^,~}~%"</span><span class="code" style="margin-left: 147px;">(get-x (the center))</span><span class="code" style="margin-left: 147px;">(get-y (the center))</span><span class="code" style="margin-left: 147px;">(get-z (the center)))</span><span class="code" style="margin-left: 21px;">(incf i)</span><span class="code" style="margin-left: 21px;">(format s "Box Volume ~a~%" (the volume))</span><span class="code" style="margin-left: 21px;">(incf i)</span><span class="code" style="margin-left: 21px;">(format t "Output written (~a line~:p)~%" i)))))</span><span class="code" style="margin-left: 14px;">))</span></pre></div><p>Here, as well as sending output to the stream connected to the file, we are also sending output to the REPL using the stream T (which defaults to <b>*standard-output*</b>. This is often a useful technique to assist with development and/or debugging. We could also write a small function which takes a filename as an input and executes the file output by calling the :function Write-report!</p><div class="code-example"><pre><span class="code" style="margin-left: 0px;">(defun output-report (fname)</span><span class="code" style="margin-left: 56px;">(let ((obj (make-object 'my-box</span><span class="code" style="margin-left: 98px;">:output-filename fname)))</span><span class="code" style="margin-left: 21px;">(theo obj write-report!)))</span></pre></div><p>And then in the REPL we would see this</p><div class="repl-example"><pre><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(output-report "c:/temp/report.txt")</span></p><span class="output">Begining output to c:/temp/report.txt</span><span class="output">Output written (5 lines)</span><span class="output">NIL</span></pre></div><p>Resulting in the file c:/temp/my-file.txt being written with the following content</p><div class="code-example"><pre><span class="code" style="margin-left: 0px;">Box Width 3</span><span class="code" style="margin-left: 0px;">Box Length 6</span><span class="code" style="margin-left: 0px;">Box Height 4</span><span class="code" style="margin-left: 0px;">Box Center 0.0,0.0,0.0</span><span class="code" style="margin-left: 0px;">Box Volume 72</span></pre></div></div><div class="main-page-item"><h2>Resources</h2><table><tr><td><a href="/t4-resources/file-output.lisp"><img src="/common-images/lisp-file.png" style="width: 40px; height: auto;" /></a></td><td><a href="/t4-resources/file-output.lisp">file-output.lisp</a></td></tr></table></div></div></div></div></div></body></html>