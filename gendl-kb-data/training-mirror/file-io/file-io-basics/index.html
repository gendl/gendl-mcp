<!DOCTYPE HTML><html lang="en"><head><title>File IO Basics</title><meta charset="UTF-8" /><link rel="icon" type="image/png" href="/gorn.png" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="stylesheet" href="/css/training-style.css" /><script src="/static/3rdpty/x3dom/x3dom.js" id="x3dom_script"></script><script id="svg-panzoom" src="/static/3rdpty/svgpanzoom/svg-pan-zoom.min.js"></script><script>
var gdliid = '/shared';</script><script src="/static/gwl/js/gdlajax1595.js"></script></head><body><div class="container mx-auto"><div class="main-page-item"><div class="mt-1 ml-2 mr-5"><h2>File IO Basics</h2><p><span class="font-bold"> | </span><a class="text-blue-500" href="/file-io/index.html">^UP^</a><span class="font-bold"> | </span><a class="text-green-500" href="/file-io/writing-to-a-file/index.html">Next-&gt;</a></p><div class="main-page-container" style="grid-template-columns: 600px auto;"><div class="main-page-item"><h3>The basics of file I/O</h3><p>To read and write from or to a file, we do this via a <em>stream</em> which is connected to the file. The most basic mechanism for connecting a stream to a file is by using the CL function <span class="function">open</span>, which takes the following arguments<ul><li>filename - required</li><li>keyword argument <span class="general-keyword">:direction</span> which can be either <span class="general-keyword">:input</span> or <span class="general-keyword">:output</span> or <span class="general-keyword">:io</span> (both directions)</li><li>keyword argument <span class="general-keyword">:if-exists</span> - what to do if the file exists - the most common values being <span class="general-keyword">:overwrite</span>, <span class="general-keyword">:append</span> or <span class="general-keyword">:supersede</span>. The difference between <span class="general-keyword">:overwrite</span> and <span class="general-keyword">:supersede</span> is the former causes the existing file to be modified at the beginning of the output, whilst the latter delays the deletion of the original file until the stream is closed</li><li>keyword argument <span class="general-keyword">:if-does-not-exist</span> - the most common value is <span class="general-keyword">:create</span> where the <span class="general-keyword">:direction</span> is <span class="general-keyword">:output</span> or <span class="general-keyword">:io</span> and <span class="general-keyword">:if-exists</span> is neither <span class="general-keyword">:overwrite</span> nor <span class="general-keyword">:append</span></li></ul>There are other keyword arguments and valid values, the above are just the most commonly used.</p><div class="repl-example"><pre><span class="prompt" style="display: inline;">GDL-USER>&nbsp;&nbsp;</span><span class="command" style="margin-left: 0px;">(defparameter *my-stream* (open "c:/temp/missing-file.txt"</span><span class="command-no-prefix" style="margin-left: 287px;">:direction :output</span><span class="command-no-prefix" style="margin-left: 287px;">:if-does-not-exist :create</span><span class="output">*MY-STREAM*</span></pre></div><p>Once the file is open we can then write to that stream, for example using the format function we covered in the Getting Started with GendL tutorial.</p><div class="repl-example"><pre><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(format *MY-STREAM* "Writing to a file for the first time")</span></p><span class="output">NIL</span></pre></div><p>However, whilst the file has been created, we have to close the stream before the the output is seen in the file.</p><div class="repl-example"><pre><p style="display: inline;"><span class="prompt" style="display: inline;">GDL-USER>&nbsp;</span><span class="command" style="display: inline;">(close *MY-STREAM*)</span></p><span class="output">T</span></pre></div><div class="code-example"><pre><span class="code" style="margin-left: 0px;">Writing to a file for the first time</span></pre></div><h3>Avoiding issues by using with-open-file</h3><p>And this leads on to one of the potential issues with <span class="function">open</span>, the programmer has to remember to <em><b>always close the stream that gets opened</b></em>, and ensure it gets closed even in the event of errors. When streams are left open, results may be unpredictable and performance often suffers.</p><p>For this reason, the macro <span class="macro">with-open-file</span> is much preferred. It takes a symbol representing a stream and a path to the file as required arguments plus all of the keyword arguments used by <span class="function">open</span>, plus a body of expressions. <span class="macro">with-open-file</span> opens the stream, evaluates the body of expressions (which will invariably refer to the stream), and then closes the stream. The macro wraps all of the code in the CL special operator <span class="special-operator">unwind-protect</span> to ensure that the stream will always be closed even in the event of errors being encountered.</p></div></div></div></div></div></body></html>